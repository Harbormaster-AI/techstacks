########################################################################
## CircleCI Macros
########################################################################


########################################################################
## CircleCI Docker Image Output
########################################################################
#macro( CircleCI_OutputDockerImageDecl )        
    # CircleCI Golang
    # Postgres image
    docker:
      - image: circleci/golang:1.16
      - image: postgres
        # required env vars
        environment:
            POSTGRES_DB: ${appName}DB
            POSTGRES_USER: root
            POSTGRES_PASSWORD: letmein2 
#end##macro( CircleCI_OutputDockerImageDecl )

########################################################################
## CircleCI Run Commands
########################################################################
#macro( CircleCI_RunCommands )
      - run:        
          name: Install Gorilla Mux for as Router
          command: go get github.com/gorilla/mux 
      - run:                  
          name: Install Go ORM...
          command: go get -u gorm.io/gorm
      - run:          
          name: Install Go ORM database type...
#set( $dbType = ${aib.getParam( "go.dbType" )} )     
          command: go get -u gorm.io/driver/$dbType
      - run:          
          name: Install .env reader
          command: go get github.com/joho/godotenv
      - run:          
          name: Change to the app directory
          command: cd src/${appName} 
      - run:          
          name: Initalize, build, and test
          command: |
            cd src/${appName} 
            go mod init ${appName}
            go mod tidy
            go build
            go test   
#end###macro( CircleCI_RunCommands )

########################################################################
## CircleCI EnvVarAssignments
########################################################################
#macro( CircleCI_EnvVarAssignments )
    environment:
        POSTGRES_DB: ${appName}DB
        POSTGRES_USER: root
        POSTGRES_PASSWORD: letmein2 
        TEST_RESULTS: /tmp/test-results # path to where test results will be saved
#end##macro( CircleCI_EnvVarAssignments )