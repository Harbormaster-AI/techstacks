########################################################################
## CircleCI Macros
########################################################################

########################################################################
## CircleCI Docker Image Output - overridden from common.stack.templates
########################################################################
#macro( CircleCI_OutputDockerImageDecl )        
    # CircleCI Java8 image, installs Apache Maven
    # MySQL 8 image
    docker:
      - image: circleci/openjdk:8-jdk-browsers
      - image: mysql:8.0
        # required env vars
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: yes
            MYSQL_ROOT_PASSWORD: ''
            MYSQL_DATABASE: circleci
#end##macro( CircleCI_OutputDockerImageDecl )

########################################################################
## CircleCI Run Commands - - overridden from common.stack.templates
########################################################################
#macro( CircleCI_RunCommands )
      - run: 
#if ( ${aib.getParam('artifact-repo.inUse')} == "true" )
#set( $repoUserName = ${aib.getParam('artifact-repo.userName')} )
#set( $repoPassword = ${aib.getParam('artifact-repo.password')} )
#set( $repoRepoUrl = ${aib.getParam('artifact-repo.repoUrl')} )
          name: Running test using Junit and deploy to Nexus Repo
          command: mvn deploy --settings settings.xml -Dinternal.repo.username=${repoUserName} -Dinternal.repo.password=${repoPassword} -Dinternal.repo.url=${repoRepoUrl}
#else        
          name: compiling, running test using Junit, the create a deployable war file
          command: mvn package
#end    

      # save the results from the testing that occurred during
      # the maven packaging in the prior step
      - run:
          name: Save test results
          command: |
            mkdir -p ~/test-results/junit/
            find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} ~/test-results/junit/ \;
          when: always

#end###macro( CircleCI_RunCommands )

########################################################################
## CircleCI EnvVarAssignments - overridden from common.stack.templates
########################################################################
#macro( CircleCI_EnvVarAssignments )
    environment:
        DATABASE_USERNAME: root
        DATABASE_PASSWORD:
        DATABASE_DIALECT: org.hibernate.dialect.MySQL8Dialect
        DATABASE_DRIVER: com.mysql.jdbc.Driver
        DATABASE_URL: jdbc:mysql://localhost:3306/circleci?createDatabaseIfNotExist=true
        
#end##macro( CircleCI_EnvVarAssignments )